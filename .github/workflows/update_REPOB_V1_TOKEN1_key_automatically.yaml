name: Updating a GitHub key - REPOB_V1_TOKEN1

on:
  schedule:
    - cron: '0 6,18 * * *'
      
jobs:
  update_token:
    runs-on: ubuntu-latest

    permissions: write-all

    steps:
      - name: Assign a new value to the secret
        env:
          GH_TOKEN: ${{ secrets.REPOB_V1_TOKEN1 || github.token }}
          # The `github.token` is not equivalent to a GitHub Actions secret token. The `github.token` is a special token provided by GitHub that allows actions to authenticate and interact with the GitHub API on behalf of the workflow run. It is automatically generated and available for use within GitHub Actions workflows.
          # However, if GH_TOKEN: ${{ secrets.REPOB_V1_TOKEN1 }} OR GH_TOKEN: ${{ github.token }}, it will throw an error.
          # ${{ github.repository }} = $repoOwner/$repoName
        run: |
          repoOwner=$(echo "${{ github.repository }}" | cut -d '/' -f 1);
          repoOwnerEmail="j622amilah@gmail.com";
          repoName=$(echo "${{ github.repository }}" | cut -d '/' -f 2);
          main_directory=$(echo "/home/runner/work");
          cd $main_directory;
          URL=$(echo "https://${{ env.GH_TOKEN }}@github.com/$repoOwner/$repoName.git");
          
          git config --global user.email ${repoOwnerEmail};
          git config --global user.name ${repoOwner};
          git config --global remote.origin.url $URL;
          git config --global --add safe.directory $main_directory;
          git config --global init.defaultBranch main;
          git init;
          
          git remote add origin https://github.com/$repoOwner/$repoName.git;
          git pull origin main;
          
          git branch -m main;
          git branch --set-upstream-to origin/main;
          git checkout main;
          
          gh secret set REPOB_V1_TOKEN1 --app actions --body ${{ secrets.REPOB_V1_TOKEN1 }} --repos $repoOwner/$repoName
